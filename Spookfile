{:command} = require 'spookfile_helpers'
{:is_file} = require "fs"

-- builtin notifier
notify.add 'terminal_notifier'

-- user notifiers
pcall notify.add, 'notifier'

log_level "INFO"

spec = command "busted"
compile = command "moonc"

watch "src", "spec", ->
  on_changed "^spec/.+_spec%.moon", (event) ->
    spec event.path

  on_changed "^src/moonpick/.+%.moon", (event) ->
    base = event.path\match '([^/]+)%.moon'
    spec_file = "spec/#{base}_spec.moon"
    spec_file = "spec/moonpick_spec.moon" unless is_file(spec_file)

    compile("src/moonpick/#{base}.moon") +
    spec(spec_file)

watch_file 'Spookfile', ->
  on_changed (event) ->
    notify.info "Reloading Spookfile..."
    load_spookfile!
